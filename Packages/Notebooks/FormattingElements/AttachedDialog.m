(* ::Package:: *)

(* Autogenerated Package *)

AttachedDialogPanel::usage="";
CreateAttachedDialog::usage="";


IDECreateDialog::usage="";


Begin["`Private`"];


(* ::Subsection:: *)
(*CreateAttachedDialog*)



(* ::Subsubsection::Closed:: *)
(*AttachedDialogPanel*)



AttachedDialogPanel[
  expr_,
  ops:OptionsPattern[]
  ]:=
  Panel[
    expr,
    BaseStyle->"AttachedDialog",
    ops
    ];


prepSubmitButton[{label_, action_, ops___}]:=
  Button[label, action,
    ops,
    BaseStyle->"AttachedDialogDefaultButton",
    Appearance->Inherited,
    Evaluator->Inherited,
    Method->Inherited
    ];
prepCancelButton[{label_, action_, ops___}]:=
  Button[label, 
    action,
    ops,
    BaseStyle->"AttachedDialogCancelButton",
    Appearance->Inherited,
    Evaluator->Inherited,
    Method->Inherited
    ]


AttachedDialogPanel[
  header_,
  expr_,
  submitButton:{_, _Function|None, ___}:{"OK", None},
  closingButton:{_, _Function|Automatic, ___}:{"Cancel", Automatic},
  ops:OptionsPattern[]
  ]:=
  AttachedDialogPanel[
    Column[
      {
        Panel[header, BaseStyle->"AttachedDialogHeader"],
        Panel[expr, BaseStyle->"AttachedDialogBody"],
        Panel[
          Grid@{
            {prepSubmitButton@submitButton, prepCancelButton@closingButton}
            }, 
          BaseStyle->"AttachedDialogButtons"
          ]
        },
      GridBoxItemSize->Inherited
      ],
    ops
    ]


(* ::Subsubsection::Closed:: *)
(*CreateAttachedDialog*)



attachables=
  _NotebookObject|_FrontEnd`EvaluationNotebook|_FrontEnd`InputNotebook|
  _FrontEnd`SelectedNotebook|_FrontEnd`ParentNotebook|_FrontEnd`ButtonNotebook|
  _CellObject|_FrontEnd`EvaluationCell|_FrontEnd`ParentCell|_FrontEnd`IndexedCell|
  _BoxObject|_FrontEnd`EvaluationBox|_FrontEnd`ParentBox;


CreateAttachedDialog//Clear
CreateAttachedDialog[
  nb:attachables, 
  expression_, 
  position:{_Integer|_Scaled, _Integer|_Scaled}:{0, 0},
  align:{Left|Center|Right, Bottom|Center|Top}:{Center, Center},
  anchor:{Left|Center|Right, Bottom|Center|Top}:{Center, Center},
  closers:{("MouseExit"|"OutsideMouseClick"|"EvaluatorQuit")..}:{"EvaluatorQuit"},
  ops:OptionsPattern[]
  ]:=
  FEAttachCell[
    nb,
    Cell[
      BoxData@ToBoxes@
        AttachedDialogPanel[expression],
      "AttachedDialogCell",
      ops,
      FirstCase[
        expression,
        i:InputField[___, BoxID->b_, ___]:>
          (
            CellDynamicExpression:>
              Refresh[
                  FrontEnd`MoveCursorToInputField[
                    EvaluationNotebook[], 
                    b
                    ];,
                  None
                ]
            )
        ]
      ],
    Offset[position, 0],
    align,
    anchor,
    closers
    ];
CreateAttachedDialog[ 
  expression:Except[attachables], 
  position:{_Integer|_Scaled, _Integer|_Scaled}:{0, 0},
  align:{Left|Center|Right, Bottom|Center|Top}:{Center, Center},
  anchor:{Left|Center|Right, Bottom|Center|Top}:{Center, Center}
  ]:=
  CreateAttachedDialog[
    $CurrentIDENotebook,
    expression,
    position,
    align,
    anchor
    ]


(* ::Subsection:: *)
(*IDECreateDialog*)



IDECreateDialog[nb_NotebookObject, expr_, args___]:=
  CreateAttachedDialog[nb, expr, args];
IDECreateDialog[ide_IDENotebookObject, expr_, args___]:=
  CreateAttachedDialog[ide["Notebook"], expr, args];


End[];



