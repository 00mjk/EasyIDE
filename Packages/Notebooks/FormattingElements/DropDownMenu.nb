Notebook[{Cell[CellGroupData[{Cell["DropDown Menus", "CodeSection"], 
     Cell[BoxData[RowBox[{RowBox[{RowBox[{"DestroyDropDownMenu", "::", 
             "usage"}], "=", "\n", "\t", 
           "\"Destroys a DropDown menu from its saved state\""}], ";"}]], 
      "CodeInput"], Cell[BoxData[RowBox[
        {RowBox[{RowBox[{"AttachDropDownMenu", "::", "usage"}], "=", "\n", 
           "\t", "\"Attaches a dropdown menu\""}], ";"}]], "CodeInput"], 
     Cell[BoxData[RowBox[{RowBox[{"Begin", "[", "\"`Private`\"", "]"}], 
         ";"}]], "InputSection"], 
     Cell[CellGroupData[
       {Cell["\[LeftCeiling]Attached Cell Menu\[RightFloor]", 
         "CodeSubsection", Evaluatable -> True], 
        Cell[CellGroupData[{Cell["\[LeftCeiling]makeMenuExpr\[RightFloor]", 
            "CodeSubsubsection", Evaluatable -> True], 
           Cell[BoxData[RowBox[{RowBox[{RowBox[{"makeMenuExpr", "[", 
                   RowBox[{RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", "[", 
                          "Dynamic", "]"}], "[", "state_", "]"}]}], ",", " ", 
                     "menuList_"}], "]"}], ":=", "\n", "\t", RowBox[
                  {"Pane", "[", "\n", "\t\t", RowBox[{RowBox[{"Panel", "[", 
                       "\n", "\t\t\t", RowBox[{RowBox[{"Column", "[", "\n", 
                          "\t\t\t\t", RowBox[{RowBox[{RowBox[{RowBox[
                          {"makeMenuCommand", "[", RowBox[{"s", ",", " ", 
                          "#"}], "]"}], "&"}], "/@", "menuList"}], ",", "\n", 
                          "\t\t\t\t", RowBox[{"GridBoxItemSize", "\[Rule]", 
                          "Inherited"}], ",", "\n", "\t\t\t\t", RowBox[
                          {"GridBoxAlignment", "\[Rule]", "Inherited"}]}], 
                          "\n", "\t\t\t\t", "]"}], ",", "\n", "\t\t\t", 
                         RowBox[{"BaseStyle", "\[Rule]", 
                          "\"CascadingMenuMain\""}]}], "\n", "\t\t\t", "]"}], 
                     ",", "\n", "\t\t", RowBox[{"BaseStyle", "\[Rule]", 
                       "\"CascadingMenuMain\""}], ",", "\n", "\t\t", 
                     RowBox[{"ImageSizeAction", "\[Rule]", "\"Clip\""}]}], 
                   "\n", "\t\t", "]"}]}], ";"}]], "CodeInput"]}, Closed]], 
        Cell[CellGroupData[
          {Cell["\[LeftCeiling]makeMenuCommand\[RightFloor]", 
            "CodeSubsubsection", Evaluatable -> True], 
           Cell[BoxData[RowBox[{"makeMenuCommand", "//", "Clear"}]], 
            "CodeInput", CellLabel -> "In[946]:="], 
           Cell[BoxData[RowBox[{RowBox[{"makeMenuCommand", "[", 
                 RowBox[{RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", "[", 
                         "Dynamic", "]"}], "[", "state_", "]"}]}], ",", " ", 
                   "CancelButton"}], "]"}], ":=", "\n", "  ", RowBox[
                {"Button", "[", "\n", "    ", RowBox[{"\"\"", ",", "\n", 
                   "  ", "  ", RowBox[{"DestroyDropDownMenu", "[", "s", 
                     "]"}], ",", "\n", "  ", "  ", RowBox[{"BaseStyle", 
                     "\[Rule]", "\"CascadingMenuCloseButton\""}], ",", "\n", 
                   "  ", "  ", RowBox[{"Appearance", "\[Rule]", 
                     "Inherited"}]}], "\n", "  ", "  ", "]"}]}]], 
            "CodeInput"], Cell[BoxData[RowBox[{RowBox[{"makeMenuCommand", 
                 "[", RowBox[{RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", 
                         "[", "Dynamic", "]"}], "[", "state_", "]"}]}], ",", 
                   " ", RowBox[{"label_", "->", "list_List"}]}], "]"}], ":=", 
               "\n", "\t\t", RowBox[{"Button", "[", "\n", "\t\t\t", 
                 RowBox[{RowBox[{"Pane", "[", RowBox[{"label", ",", " ", 
                       RowBox[{"BaseStyle", "\[Rule]", 
                         "\"CascadingMenuSubmenu\""}]}], "]"}], ",", "\n", 
                   "\t\t\t", RowBox[{"attachMenuExpr", "[", RowBox[{"s", ",", 
                       " ", RowBox[{"EvaluationBox", "[", "]"}], ",", " ", 
                       RowBox[{"makeMenuExpr", "[", RowBox[{"s", ",", " ", 
                          "list"}], "]"}]}], "]"}], ",", "\n", "\t\t\t", 
                   RowBox[{"BaseStyle", "\[Rule]", 
                     "\"CascadingMenuSubmenu\""}], ",", "\n", "\t\t\t", 
                   RowBox[{"Appearance", "\[Rule]", "Inherited"}]}], "\n", 
                 "\t\t\t", "]"}]}]], "CodeInput"], 
           Cell[BoxData[{RowBox[{RowBox[{RowBox[{"makeMenuCommand", "[", 
                    RowBox[{RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", 
                          "[", "Dynamic", "]"}], "[", "state_", "]"}]}], ",", 
                      " ", RowBox[{"label_", "\[RuleDelayed]", RowBox[
                         {"{", RowBox[{"command_", ",", " ", "ops___"}], 
                          "}"}]}]}], "]"}], ":=", "\n", "\t", RowBox[
                   {"EventHandler", "[", "\n", "\t\t", RowBox[
                     {RowBox[{"Button", "[", "\n", "\t\t\t", RowBox[
                         {RowBox[{"Pane", "[", RowBox[{"label", ",", " ", 
                          RowBox[{"BaseStyle", "\[Rule]", 
                          "\"CascadingMenuCommand\""}]}], "]"}], ",", "\n", 
                          "\t\t\t", RowBox[{"Internal`WithLocalSettings", 
                          "[", "\n", "\t\t\t\t", RowBox[{"Null", ",", "\n", 
                          "\t\t\t\t", RowBox[{"If", "[", RowBox[{RowBox[
                          {RowBox[{"Quiet", "[", RowBox[{"Lookup", "[", 
                          RowBox[{RowBox[{"Flatten", "@", RowBox[{"{", "ops", 
                          "}"}]}], ",", " ", "Method", ",", " ", 
                          "Automatic"}], "]"}], "]"}], "===", "Automatic"}], 
                          ",", "\n", "\t\t\t\t  ", RowBox[{
                          "PreemptiveQueued", "[", "command", "]"}], ",", 
                          "\n", "\t\t\t\t  ", "command"}], "\n", 
                          "\t\t\t\t  ", "]"}], ",", "\n", "\t\t\t\t", RowBox[
                          {RowBox[{"If", "[", RowBox[{RowBox[{"state", "[", 
                          "\"DestroyOnClick\"", "]"}], ",", " ", RowBox[
                          {"DestroyDropDownMenu", "[", "s", "]"}]}], "]"}], 
                          ";"}]}], "\n", "\t\t\t\t", "]"}], ",", "\n", 
                          "\t\t\t", RowBox[{"ButtonData", "\[RuleDelayed]", 
                          "s"}], ",", "\n", "\t\t\t", RowBox[{"BaseStyle", 
                          "\[Rule]", "\"CascadingMenuCommand\""}], ",", "\n", 
                          "\t\t\t", RowBox[{"Appearance", "\[Rule]", 
                          "Inherited"}], ",", "\n", "\t\t\t", "ops"}], "\n", 
                        "\t\t\t", "]"}], ",", "\n", "\t ", RowBox[{"{", "\n", 
                        "\t \t", RowBox[{RowBox[{"\"MouseEntered\"", " ", 
                          "\[RuleDelayed]", " ", RowBox[{"pruneMenu", "[", 
                          RowBox[{"s", ",", " ", RowBox[{"EvaluationCell", 
                          "[", "]"}], ",", " ", "False"}], "]"}]}], ",", 
                          "\n", "\t \t", RowBox[{"PassEventsDown", "\[Rule]", 
                          "True"}]}], "\n", "\t \t", "}"}]}], "\n", "\t ", 
                    "]"}]}], ";"}], "\n", RowBox[{RowBox[{"makeMenuCommand", 
                  "[", RowBox[{RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", 
                          "[", "Dynamic", "]"}], "[", "state_", "]"}]}], ",", 
                    " ", RowBox[{"label_", "\[RuleDelayed]", "command_"}]}], 
                  "]"}], ":=", "\n", "\t", RowBox[{"makeMenuCommand", "[", 
                  RowBox[{"s", ",", " ", RowBox[{"label", "\[RuleDelayed]", 
                      RowBox[{"{", "command", "}"}]}]}], "]"}]}]}], 
            "CodeInput"], Cell[BoxData[RowBox[{RowBox[{"makeMenuCommand", 
                 "[", RowBox[{RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", 
                         "[", "Dynamic", "]"}], "[", "state_", "]"}]}], ",", 
                   " ", "Delimiter"}], "]"}], ":=", "\n", "\t", RowBox[
                {"Framed", "[", RowBox[{"\"\"", ",", " ", "\n", "\t\t", 
                   RowBox[{"FrameStyle", "\[Rule]", RowBox[{"GrayLevel", "[", 
                       ".8", "]"}]}], ",", "\n", "\t\t", RowBox[{"ImageSize", 
                     "\[Rule]", RowBox[{"{", RowBox[{RowBox[{"Scaled", "[", 
                          "1", "]"}], ",", " ", "0"}], "}"}]}], ",", "\n", 
                   "\t\t", RowBox[{"FrameMargins", "\[Rule]", RowBox[
                      {"{", RowBox[{RowBox[{"{", RowBox[{"0", ",", " ", 
                          "0"}], "}"}], ",", " ", RowBox[{"{", RowBox[
                          {RowBox[{"-", "1"}], ",", " ", "0"}], "}"}]}], 
                       "}"}]}]}], "\n", "\t\t", "]"}]}]], "CodeInput", 
            CellLabel -> "In[949]:="]}, Closed]], 
        Cell[CellGroupData[{Cell["\[LeftCeiling]pruneMenu\[RightFloor]", 
            "CodeSubsubsection", Evaluatable -> True], 
           Cell[BoxData[RowBox[{RowBox[{"pruneMenu", "[", RowBox[
                  {RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", "[", 
                         "Dynamic", "]"}], "[", "state_", "]"}]}], ",", " ", 
                   "root_", ",", " ", RowBox[{"pruneHead", ":", RowBox[
                      {"True", "|", "False"}], ":", "True"}]}], "]"}], ":=", 
               "\n", "\t", RowBox[{"Module", "[", "\n", "\t\t", 
                 RowBox[{RowBox[{"{", "\n", "\t\t\t", "kid", "\n", "\t\t\t", 
                     "}"}], ",", "\n", "\t\t", RowBox[{RowBox[{"kid", " ", 
                       "=", " ", RowBox[{RowBox[{"state", "[", "root", "]"}], 
                         "[", "\"Submenu\"", "]"}]}], ";", "\n", "\t\t", 
                     RowBox[{RowBox[{"Replace", "[", RowBox[{RowBox[
                          {"ParentNotebook", "@", "root"}], ",", "\n", 
                          "\t\t  ", RowBox[{"{", "\n", "\t\t    ", RowBox[
                          {RowBox[{"nb_NotebookObject", ":>", "\n", 
                          "  \t\t    ", RowBox[{"Function", "[", RowBox[
                          {"Null", ",", " ", RowBox[{"WithoutScreenUpdates", 
                          "[", RowBox[{"nb", ",", " ", "#"}], "]"}], ",", 
                          " ", "HoldAllComplete"}], "]"}]}], ",", "\n", 
                          "  \t\t  ", RowBox[{"_", "\[Rule]", "Identity"}]}], 
                          "\n", "  \t\t  ", "}"}]}], "\n", "  \t\t", "]"}], 
                       "[", "\n", "\t\t\t", RowBox[{RowBox[{"If", "[", 
                          RowBox[{RowBox[{RowBox[{"Head", "[", "kid", "]"}], 
                          "===", "CellObject"}], ",", "\n", "\t\t\t\t", 
                          RowBox[{"pruneMenu", "[", RowBox[{"s", ",", " ", 
                          "kid"}], "]"}]}], "\n", "\t\t\t\t", "]"}], ";", 
                         "\n", "\t\t\t", RowBox[{"If", "[", RowBox[
                          {"pruneHead", ",", " ", "\n", "\t", "\t\t\t", 
                          RowBox[{RowBox[{"NotebookDelete", "[", "root", 
                          "]"}], ";", "\n", "\t\t\t\t", RowBox[{"If", "[", 
                          RowBox[{RowBox[{"KeyExistsQ", "[", RowBox[{"state", 
                          ",", " ", "root"}], "]"}], ",", "\n", "\t\t\t\t\t", 
                          RowBox[{RowBox[{"state", "[", "root", "]"}], 
                          "=."}]}], "\n", "\t\t\t\t\t", "]"}]}], ",", "\n", 
                          "\t\t\t\t", RowBox[{"If", "[", RowBox[{RowBox[
                          {"KeyExistsQ", "[", RowBox[{"state", ",", " ", 
                          "root"}], "]"}], ",", "\n", "\t\t\t\t\t", RowBox[
                          {RowBox[{RowBox[{"state", "[", RowBox[{"root", ",", 
                          " ", "\"Submenu\""}], "]"}], "=."}], ";", "\n", 
                          "\t\t\t\t\t", RowBox[{RowBox[{"state", "[", RowBox[
                          {"root", ",", " ", "\"MenuBox\""}], "]"}], "=."}], 
                          ";"}]}], "\n", "\t\t\t\t\t", "]"}]}], "\n", 
                          "\t\t\t\t", "]"}], ";"}], "\n", "\t\t  ", 
                       "]"}]}]}], "\n", "\t\t", "]"}]}]], "CodeInput"]}, 
          Open]], Cell[CellGroupData[
          {Cell["\[LeftCeiling]attachMenuExpr\[RightFloor]", 
            "CodeSubsubsection", Evaluatable -> True], 
           Cell[BoxData[RowBox[{RowBox[{RowBox[{"attachMenuExpr", "[", 
                   RowBox[{RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", "[", 
                          "Dynamic", "]"}], "[", "state_", "]"}]}], ",", " ", 
                     "parentBox_", ",", " ", "menuExpr_"}], "]"}], ":=", 
                 "\n", "\t", RowBox[{"Module", "[", "\n", "\t\t", 
                   RowBox[{RowBox[{"{", "\n", "\t\t\t", RowBox[{"parentCell", 
                         ",", "\n", "\t\t\t", "cell", ",", "\n", "\t\t\t", 
                         "currentKids", ",", "\n", "\t\t\t", "attachPoint", 
                         ",", "\n", "\t\t\t", "subAttach", ",", "\n", 
                         "\t\t\t", "attchPos"}], "\n", "\t\t\t", "}"}], ",", 
                     "\n", "\t\t", RowBox[{RowBox[{"parentCell", " ", "=", 
                         " ", RowBox[{"ParentCell", "@", "parentBox"}]}], 
                       ";", "\n", "\t\t", RowBox[{"If", "[", RowBox[
                          {RowBox[{"!", RowBox[{"KeyExistsQ", "[", RowBox[
                          {"state", ",", " ", "parentCell"}], "]"}]}], ",", 
                          " ", "\n", "\t\t\t", RowBox[{RowBox[{"state", "[", 
                          "parentCell", "]"}], " ", "=", " ", RowBox[{"<|", 
                          "|>"}]}]}], "\n", "\t\t\t", "]"}], ";", "\n", 
                       "\t\t", RowBox[{"state", "[", RowBox[{"parentCell", 
                          ",", " ", "\"MenuBox\""}], "]"}], ";", "\n", 
                       "\t\t", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[
                          {RowBox[{"state", "[", RowBox[{"parentCell", ",", 
                          " ", "\"MenuBox\""}], "]"}], " ", "=!=", " ", 
                          "parentBox"}], " ", "||", " ", "\n", "\t\t\t\t", 
                          RowBox[{"(", "\n", "\t\t\t\t\t", RowBox[{RowBox[
                          {RowBox[{"Head", "[", RowBox[{"state", "[", RowBox[
                          {"parentCell", ",", " ", "\"Submenu\""}], "]"}], 
                          "]"}], " ", "===", " ", "CellObject"}], "&&", "\n", 
                          "\t\t\t\t\t\t", RowBox[{RowBox[{"NotebookRead", 
                          "[", RowBox[{"state", "[", RowBox[{"parentCell", 
                          ",", " ", "\"Submenu\""}], "]"}], "]"}], " ", 
                          "===", " ", "$Failed"}]}], "\n", "\t\t\t\t\t", 
                          ")"}]}], ",", "\n", "\t\t\t", RowBox[{RowBox[
                          {"pruneMenu", "[", RowBox[{"s", ",", " ", 
                          "parentCell", ",", " ", "False"}], "]"}], ";", 
                          "\n", "\t\t\t", RowBox[{"attachPoint", " ", "=", 
                          " ", "\n", "\t\t\t\t", RowBox[{"Replace", "[", 
                          RowBox[{RowBox[{"s", "[", "\"RootPosition\"", 
                          "]"}], ",", "\n", "\t\t\t\t\t", RowBox[{"{", "\n", 
                          "\t\t\t\t\t\t", RowBox[{RowBox[{"Left", "->", 
                          "Right"}], ",", "\n", "\t\t\t\t\t\t", RowBox[
                          {RowBox[{"n_", "?", "Positive"}], "\[Rule]", 
                          "Right"}], ",", "\n", "\t\t\t\t\t\t", RowBox[{"_", 
                          "\[Rule]", "Left"}]}], "\n", "\t\t\t\t\t\t", 
                          "}"}]}], "\n", "\t\t\t\t\t", "]"}]}], ";", "\n", 
                          "\t\t\t", RowBox[{"cell", "=", "\n", "\t\t\t\t", 
                          RowBox[{"FEAttachCell", "[", "\n", "\t\t\t\t\t", 
                          RowBox[{"parentBox", ",", "\n", "\t\t\t\t\t", 
                          "menuExpr", ",", "\n", "\t\t\t\t\t", RowBox[
                          {"Offset", "[", RowBox[{RowBox[{"{", RowBox[{"0", 
                          ",", " ", "0"}], "}"}], ",", " ", "0"}], "]"}], 
                          ",", "\n", "\t\t\t\t\t", RowBox[{"{", RowBox[
                          {"attachPoint", ",", " ", "Top"}], "}"}], ",", 
                          "\n", "\t\t\t\t\t", RowBox[{"{", RowBox[{RowBox[
                          {"Replace", "[", RowBox[{"attachPoint", ",", " ", 
                          RowBox[{"{", RowBox[{RowBox[{"Left", "\[Rule]", 
                          "Right"}], ",", " ", RowBox[{"Right", "\[Rule]", 
                          "Left"}]}], "}"}]}], "]"}], ",", " ", "Top"}], 
                          "}"}], ",", "\n", "\t\t\t\t\t", RowBox[{"{", 
                          "\"EvaluatorQuit\"", "}"}]}], "\n", "\t\t\t\t\t", 
                          "]"}]}], ";", "\n", "\t\t\t", RowBox[{RowBox[
                          {"state", "[", RowBox[{"parentCell", ",", " ", 
                          "\"MenuBox\""}], "]"}], " ", "=", " ", 
                          "parentBox"}], ";", "\n", "\t\t\t", RowBox[
                          {RowBox[{"state", "[", RowBox[{"parentCell", ",", 
                          " ", "\"Submenu\""}], "]"}], " ", "=", " ", 
                          "cell"}]}]}], "\n", "\t\t\t", "]"}], ";"}]}], "\n", 
                   "\t\t", "]"}]}], ";"}]], "CodeInput"]}, Open]], 
        Cell[CellGroupData[
          {Cell["\[LeftCeiling]DestroyDropDownMenu\[RightFloor]", 
            "CodeSubsubsection", Evaluatable -> True], 
           Cell[BoxData[RowBox[{RowBox[{RowBox[{"DestroyDropDownMenu", "[", 
                   RowBox[{"s", ":", RowBox[{RowBox[{"Verbatim", "[", 
                         "Dynamic", "]"}], "[", "state_", "]"}]}], "]"}], 
                 ":=", "\n", "\t", RowBox[{"(", "\n", "\t\t", RowBox[
                    {RowBox[{"pruneMenu", "[", RowBox[{"s", ",", " ", 
                         RowBox[{"state", "[", "\"RootCell\"", "]"}], ",", 
                         " ", "True"}], "]"}], ";", "\n", "\t\t", RowBox[
                      {RowBox[{"state", "[", "\"RootCell\"", "]"}], "=."}], 
                     ";", "\n", "\t\t", RowBox[{RowBox[{"state", "[", 
                         "\"Root\"", "]"}], "=."}], ";"}], "\n", "\t\t", 
                   ")"}]}], ";"}]], "CodeInput"]}, Open]], 
        Cell[CellGroupData[
          {Cell["\[LeftCeiling]AttachDropDownMenu\[RightFloor]", 
            "CodeSubsubsection", Evaluatable -> True], 
           Cell[BoxData[{RowBox[{"AttachDropDownMenu", "//", "Clear"}], "\n", 
              RowBox[{RowBox[{"Options", "[", "AttachDropDownMenu", "]"}], 
                "=", "\n", "  ", RowBox[{"{", "\n", "    ", RowBox[
                   {RowBox[{"\"AttachToCell\"", "\[Rule]", "True"}], ",", 
                    "\n", "    ", RowBox[{"\"AttachToNotebook\"", "\[Rule]", 
                      "False"}], ",", "\n", "    ", RowBox[{"\"Position\"", 
                      "->", "Automatic"}], ",", "\n", "    ", RowBox[
                     {"\"DestroyOnClick\"", "\[Rule]", "True"}]}], "\n", 
                  "    ", "}"}]}], "\n", RowBox[{RowBox[
                 {RowBox[{"AttachDropDownMenu", "[", "\n", "\t", RowBox[
                     {RowBox[{"stateTracker", ":", RowBox[{"(", RowBox[
                          {RowBox[{"Verbatim", "[", "Dynamic", "]"}], "[", 
                          "_", "]"}], RowBox[{"(*", RowBox[{"|", "None"}], 
                          "*)"}], ")"}]}], ",", "\n", "\t", RowBox[
                       {"parentBox", ":", RowBox[{"_BoxObject", "|", 
                          "Automatic"}], ":", "Automatic"}], ",", " ", "\n", 
                      "\t", "menuCommands_List", ",", "\n", "\t", RowBox[
                       {"ops", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], 
                    "\n", "\t", "]"}], ":=", "\n", "\t", RowBox[{"With", "[", 
                    "\n", "\t\t", RowBox[{RowBox[{"{", "\n", "\t\t\t", 
                        RowBox[{RowBox[{"box", "=", RowBox[{"Replace", "[", 
                          RowBox[{"parentBox", ",", " ", RowBox[{"Automatic", 
                          "\[RuleDelayed]", RowBox[{"EvaluationBox", "[", 
                          "]"}]}]}], "]"}]}], ",", "\n", "\t\t\t", RowBox[
                          {"position", " ", "=", " ", RowBox[{"OptionValue", 
                          "[", "\"Position\"", "]"}]}], ",", "\n", "\t\t\t", 
                          RowBox[{"attachNb", " ", "=", " ", RowBox[{"TrueQ", 
                          "@", RowBox[{"OptionValue", "[", 
                          "\"AttachToNotebook\"", "]"}]}]}], ",", "\n", 
                          "\t\t\t", RowBox[{"attachCell", " ", "=", " ", 
                          RowBox[{"TrueQ", "@", RowBox[{"OptionValue", "[", 
                          "\"AttachToCell\"", "]"}]}]}], ",", "\n", "\t\t\t", 
                          RowBox[{"clickDest", " ", "=", " ", RowBox[
                          {"TrueQ", "@", RowBox[{"OptionValue", "[", 
                          "\"DestroyOnClick\"", "]"}]}]}], ",", "\n", 
                          "\t\t\t", RowBox[{"state", "=", "\n", "\t\t\t\t", 
                          RowBox[{"Replace", "[", RowBox[{"stateTracker", 
                          ",", " ", "\n", "\t\t\t\t\t", RowBox[{"None", 
                          "\[RuleDelayed]", RowBox[{"Module", "[", RowBox[
                          {RowBox[{"{", "menuState", "}"}], ",", " ", RowBox[
                          {"Dynamic", "[", "menuState", "]"}]}], "]"}]}]}], 
                          "\n", "\t\t\t\t\t", "]"}]}]}], "\n", "\t\t\t", 
                        "}"}], ",", "\n", "\t\t", RowBox[{"iMakeMenu", "[", 
                        RowBox[{"state", ",", " ", "box", ",", " ", 
                          "position", ",", " ", "attachCell", ",", " ", 
                          "attachNb", ",", " ", "clickDest", ",", " ", 
                          "menuCommands"}], "]"}]}], "\n", "\t\t", "]"}]}], 
                ";"}]}], "CodeInput"], Cell[BoxData[{RowBox[{"iMakeMenu", 
                "//", "Clear"}], "\n", RowBox[{RowBox[{RowBox[{"iMakeMenu", 
                    "[", "\n", "  ", RowBox[{RowBox[{"s", ":", RowBox[
                         {RowBox[{"Verbatim", "[", "Dynamic", "]"}], "[", 
                          "menuState_", "]"}]}], ",", " ", "\n", "  ", 
                      "box_", ",", " ", "\n", "  ", "position_", ",", " ", 
                      "\n", "  ", "attachCell_", ",", "\n", "  ", 
                      "attachNb_", ",", " ", "\n", "  ", "clickDest_", ",", 
                      "\n", "  ", "menuCommands_"}], "\n", "  ", "]"}], ":=", 
                  "\n", "  ", RowBox[{"Module", "[", RowBox[{RowBox[
                       {"{", RowBox[{"align", ",", " ", "pos", ",", " ", 
                          "rootCell", ",", " ", "posSpec", ",", " ", 
                          "attachLR", ",", " ", "attachTo", ",", " ", 
                          "closeSpec"}], "}"}], ",", "\n", "    ", RowBox[
                       {RowBox[{"align", " ", "=", " ", RowBox[{"pos", " ", 
                          "=", " ", "\n", "      ", RowBox[{"Replace", "[", 
                          RowBox[{"position", ",", "\n", "        ", RowBox[
                          {"{", "\n", "          ", RowBox[{"Automatic", 
                          "\[RuleDelayed]", RowBox[{"If", "[", RowBox[{RowBox[
                          {"attachCell", "||", "attachNb"}], ",", " ", 
                          "Right", ",", " ", "Left"}], "]"}]}], "\n", "  ", 
                          "        ", "}"}]}], "\n", "  ", "       ", 
                          "]"}]}]}], ";", " ", RowBox[{"(*", " ", RowBox[
                          {"this", " ", "will", " ", "need", " ", "an", " ", 
                          "update", " ", "once", " ", "I", " ", "am", " ", 
                          "able", " ", "to", " ", "get", " ", "the", " ", 
                          "box", " ", "position"}], " ", "*)"}], "\n", 
                        "    ", RowBox[{"If", "[", RowBox[{RowBox[{"!", 
                          RowBox[{"AssociationQ", "[", "menuState", "]"}]}], 
                          ",", " ", RowBox[{"menuState", "=", RowBox[{"<|", 
                          "|>"}]}]}], "]"}], ";", "\n", "    ", RowBox[
                         {RowBox[{"menuState", "[", "\"RootPosition\"", 
                          "]"}], " ", "=", " ", "align"}], ";", "\n", "    ", 
                        RowBox[{RowBox[{"menuState", "[", "\"AttachToCell\"", 
                          "]"}], " ", "=", " ", "attachCell"}], ";", "\n", 
                        "    ", RowBox[{RowBox[{"menuState", "[", 
                          "\"AttachToNotebook\"", "]"}], " ", "=", " ", 
                          "attachNb"}], ";", "\n", "    ", RowBox[
                         {RowBox[{"menuState", "[", "\"DestroyOnClick\"", 
                          "]"}], " ", "=", " ", "clickDest"}], ";", "\n", 
                        "    ", RowBox[{RowBox[{"menuState", "[", "\"Root\"", 
                          "]"}], " ", "=", " ", "box"}], ";", "\n", "    ", 
                        RowBox[{"rootCell", " ", "=", "\n", "      ", 
                          RowBox[{"Cell", "[", "\n", "        ", RowBox[
                          {"BoxData", "@", RowBox[{"ToBoxes", "@", "\n", 
                          "  ", "        ", RowBox[{"makeMenuExpr", "[", 
                          "\n", "  ", "          ", RowBox[{"s", ",", " ", 
                          "\n", "  ", "          ", RowBox[{"Prepend", "[", 
                          RowBox[{"menuCommands", ",", " ", "CancelButton"}], 
                          "]"}]}], "\n", "  ", "          ", "]"}]}]}], "\n", 
                          "  ", "      ", "]"}]}], ";", "\n", "   ", 
                        RowBox[{"posSpec", " ", "=", " ", "\n", "     ", 
                          RowBox[{"Replace", "[", RowBox[{"align", ",", " ", 
                          "\n", "       ", RowBox[{"{", "\n", "         ", 
                          RowBox[{RowBox[{"Left", "\[Rule]", "Automatic"}], 
                          ",", " ", "\n", "         ", RowBox[{"Right", 
                          "\[Rule]", "\n", "           ", RowBox[{"If", "[", 
                          RowBox[{"attachCell", ",", " ", RowBox[{"Offset", 
                          "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"-", 
                          "22"}], ",", " ", RowBox[{"-", "1"}]}], "}"}], ",", 
                          " ", "0"}], "]"}], ",", " ", "Automatic"}], 
                          "]"}]}]}], "\n", "          ", "}"}]}], "\n", 
                          "        ", "]"}]}], ";", "\n", "   ", RowBox[
                         {"attachLR", " ", "=", "\n", "     ", RowBox[{"If", 
                          "[", RowBox[{RowBox[{"attachCell", "||", 
                          "attachNb"}], ",", " ", "align", ",", " ", RowBox[
                          {"Replace", "[", RowBox[{"align", ",", " ", RowBox[
                          {"{", RowBox[{RowBox[{"Left", "\[Rule]", "Right"}], 
                          ",", " ", RowBox[{"Right", "\[Rule]", "Left"}]}], 
                          "}"}]}], "]"}]}], "]"}]}], ";", "\n", "   ", 
                        RowBox[{"attachTo", " ", "=", " ", "\n", "     ", 
                          RowBox[{"Which", "[", "\n", "      ", RowBox[
                          {RowBox[{"TrueQ", "[", "attachNb", "]"}], ",", 
                          "\n", "        ", RowBox[{"ParentNotebook", "@", 
                          "box"}], ",", "\n", "      ", RowBox[{"TrueQ", "[", 
                          "attachCell", "]"}], ",", "\n", "        ", RowBox[
                          {"Nest", "[", RowBox[{"ParentCell", ",", " ", 
                          "box", ",", " ", "2"}], "]"}], ",", "\n", "      ", 
                          "True", ",", "\n", "        ", "box"}], "\n", 
                          "      ", "]"}]}], ";", "\n", "    ", RowBox[
                         {"closeSpec", " ", "=", " ", RowBox[{"{", RowBox[
                          {"(*", RowBox[{"\"OutsideMouseClick\"", ","}], 
                          "*)"}], " ", " ", RowBox[{"(*", RowBox[
                          {"\"ParentChanged\"", ","}], "*)"}], "  ", 
                          "\"EvaluatorQuit\"", "}"}]}], ";", "\n", "    ", 
                        RowBox[{RowBox[{"menuState", "[", "\"RootCell\"", 
                          "]"}], " ", "=", " ", "\n", "      ", RowBox[
                          {"FEAttachCell", "[", "\n", "        ", RowBox[
                          {"attachTo", ",", "\n", "  ", "      ", "rootCell", 
                          ",", "\n", "  ", "      ", "posSpec", ",", "\n", 
                          "        ", RowBox[{"{", RowBox[{"align", ",", " ", 
                          RowBox[{"If", "[", RowBox[{"attachCell", ",", " ", 
                          "Bottom", ",", " ", "Top"}], "]"}]}], "}"}], ",", 
                          "\n", "  ", "      ", RowBox[{"{", RowBox[
                          {"attachLR", ",", " ", "Top"}], "}"}], ",", "\n", 
                          "        ", "closeSpec"}], "\n", "        ", 
                          "]"}]}]}]}], "\n", "    ", "]"}]}], ";"}]}], 
            "CodeInput"]}, Open]]}, Open]], 
     Cell[BoxData[RowBox[{RowBox[{"End", "[", "]"}], ";"}]], 
      "InputSection"]}, Open]], Cell["", "SectionSeparator"]}, 
 WindowSize -> {808, 755}, WindowMargins -> {{166, Automatic}, 
   {Automatic, 0}}, TaggingRules -> 
  {"UUIDButtons" -> 
    {"Active" -> {"Button-89ffd2c3-ec41-4179-a9b1-8e28670bca2c" -> False, 
       "Button-ca46e5e0-4fd1-47e8-8cf6-72998922b757" -> False, 
       "Button-a6d68254-3684-4d32-83fc-e5ef6f443930" -> False}}}, 
 FrontEndVersion -> 
  "11.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 5, 2018)", 
 StyleDefinitions -> FrontEnd`FileName[{"BTools"}, "CodePackage.nb", 
   CharacterEncoding -> "UTF-8"]]
